# config file for circleci
version: 2.1
jobs:
  build:
    docker:
      - image: circleci/buildpack-deps:stable
    steps:
      - checkout
      - run:
          name: install packages
          command: sudo apt-get install texinfo texi2html
      - run:
          name: configure
          command: ./configure --prefix /tmp
      - run:
          name: make
          command: make clean all tests installdocs
      - run:
          name: run utility
          command: ./dmalloc
      - run:
          name: run tests
          command: make light heavy
      - run:
          name: make distclean
          command: make distclean
      - run:
          name: configure in subdir
          command: mkdir x ; cd x ; ../configure --prefix /tmp
      - run:
          name: TMP 1
          command: cd x ; cat Makefile
      - run:
          name: TMP 2
          command: cd x ; make dmalloc.html
      - run:
          name: make in subdir
          command: cd x ; make clean all tests installdocs
      - run:
          name: run utility in subdir
          command: cd x ; ./dmalloc
      - run:
          name: run tests in subdir
          command: cd x ; make light heavy
